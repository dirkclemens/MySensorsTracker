<!-- 
    Author       : Bernd Waldmann
    Created      : Sun Oct 27 23:01:35 2019

    This Revision: $Id: messages.html 1682 2024-11-26 16:52:51Z  $    

    Copyright (C) 2019,2021 Bernd Waldmann

    # ErgÃ¤nzungen 2025 Dirk Clemens
    * OTA Firmware Management
    * Datenbank Bereinigung nach Aufbewahrungszeitraum
    * Bootstrapped Web UI
    * Diverse Verbesserungen

    This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. 
    If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/

    SPDX-License-Identifier: MPL-2.0
-->

{% extends 'base.html' %}
{% from 'macros.html' import pagecontrols with context %}
{% from 'macros.html' import td_or_none with context %}
{% from 'macros.html' import dim_if_none with context %}

{% block title %}Messages{% endblock %}

{% block header %}
  <h1>MySensors <strong>Messages</strong>
    {% if usid %} for Sensor {{ nid }}:{{ cid }} 
    {% elif nid %} for Node {{ nid }} 
    {% elif cid %} for Sensor type {{ cid }} {% endif %}
  </h1>
{% endblock %}

{% block content %}
{{ pagecontrols(nid=nid, cid=cid, usid=usid) }}
<div class="table-responsive">
<table class="table table-hover table-sm">
  <thead class="table-dark">
  <tr>
   <th class="text-center"><a href="{{ url_for(request.endpoint,sort='nid') }}" class="text-white text-decoration-none">Node</a></th>
   <th class="text-center"><a href="{{ url_for(request.endpoint,sort='cid') }}" class="text-white text-decoration-none">Sensor</a></th>
   <th class="text-center"><a href="{{ url_for(request.endpoint,sort='cmd') }}" class="text-white text-decoration-none">Cmd</a></th>
   <th>(symbol)</th>
   <th class="text-center"><a href="{{ url_for(request.endpoint,sort='typ') }}" class="text-white text-decoration-none">Type</a></th>
   <th>(symbol)</th>
   <th>Payload</th>
   <th><a href="{{ url_for(request.endpoint,sort='date') }}" class="text-white text-decoration-none">Received</a></th>
  </tr>
  </thead>
  <tbody>
  {% for entry in object_list %}
    <tr>
      <td class="text-center">
        <div class="dropdown">
          <button class="btn btn-link btn-sm dropdown-toggle p-0" type="button" data-bs-toggle="dropdown"
                  data-bs-toggle="tooltip" data-bs-placement="top" 
                  title="{{ entry.nid.sk_name or 'Unknown' }}{% if entry.nid.location %} - {{ entry.nid.location }}{% endif %}">
            {{ entry.nid.nid }}
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for(request.endpoint, nid = entry.nid.nid) }}">Show only this node</a></li>
            <li><a class="dropdown-item" href="{{ url_for(request.endpoint) }}">Show all nodes</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="{{ url_for('confirm_delete_old', ndays = 365) }}">Delete old nodes</a></li>
          </ul>
        </div>
      </td>
      <td class="text-center">
        <div class="dropdown">
          <button class="btn btn-link btn-sm dropdown-toggle p-0" type="button" data-bs-toggle="dropdown">{{ entry.cid }}</button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for(request.endpoint, cid = entry.cid) }}">Show only this sensor type</a></li>
            <li><a class="dropdown-item" href="{{ url_for(request.endpoint) }}">Show all</a></li>
          </ul>
        </div>
      </td>
      <td class="text-center">{{ entry.cmd }}</td>
      <td><code>{{ command_string(entry.cmd) }}</code></td>
      <td class="text-center">{{ entry.typ }}</td>
      <td><code>{{ type_string(entry.cmd, entry.typ) }}</code></td>
      {{ td_or_none(entry.payload) }}
      <td><small>{{ entry.received.strftime('%d.%m.%Y %H:%M:%S') }}</small></td>
    </tr>
  {% endfor %}
  </tbody>
</table>
</div>
{{ pagecontrols(nid=nid, cid=cid, usid=usid) }}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize all tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}